!function(){function isDate(t){return"undefined"!=typeof t&&"[object Date]"==Object.prototype.toString.call(t)}function isArray(t){return"undefined"!=typeof t&&"[object Array]"==Object.prototype.toString.call(t)}function isString(t){return"undefined"!=typeof t&&"[object String]"==Object.prototype.toString.call(t)}function isNumber(t){return"undefined"!=typeof t&&"[object Number]"==Object.prototype.toString.call(t)}function isPattern(t){return"undefined"!=typeof t&&"[object RegExp]"==Object.prototype.toString.call(t)}function isBoolean(t){return"undefined"!=typeof t&&"[object Boolean]"==Object.prototype.toString.call(t)}function isFunction(t){return"undefined"!=typeof t&&"[object Function]"==Object.prototype.toString.call(t)}function isInputText(t){return"undefined"!=typeof t&&t.tagName&&"input"==t.tagName.toLowerCase()&&!isCheckbox(t)&&!isSelect(t)&&!isRadio(t)}function isCheckbox(t){return"undefined"!=typeof t&&t.tagName&&"input"==t.tagName.toLowerCase()&&"checkbox"==t.getAttribute("type")}function isRadio(t){return"undefined"!=typeof t&&t.tagName&&"input"==t.tagName.toLowerCase()&&"radio"==t.getAttribute("type")}function isSelect(t){return"undefined"!=typeof t&&t.tagName&&"select"==t.tagName.toLowerCase()}function tmpl(str,data,scope){var that=scope||this;if(str)return str=str.replace(/#{([^}]*)}/g,function(val,replacement){if("input"==replacement||"select"==replacement){var fn=eval("data."+replacement);if(isFunction(fn))return fn.call(that)}return eval("data."+replacement)})}function arguing(t,e){var n=Array.prototype.slice.call(e);return n.forEach(function(e,n){t["$"+n++]=e}),t}function _V(t){if(this.el=t,this.dom=$(t),0==this.dom.length)throw new Error(tmpl("不存在选择器#{el}",{el:this.el}));return this.sequence=[],this.status={passed:!1,msg:""},this}function V(t){return new _V(t)}var $=function(t,e){return new $.fn.init(t,e)};$.fn=$.prototype,$.fn.init=function(t,e){var n=(e||document).querySelectorAll(t);this.length=n.length;for(var i=0;i<this.length;i++)this[i]=n[i];return this},$.fn.each=function(t){for(var e=0,n=this.length;n>e;e++)t.call(this[e],e,this[e]);return this},_V.patterns={"!empty":/\S/,integer:/^-?\d+$/,"positive-integer":/^[0-9]*[1-9][0-9]*$/,"negative-integer":/^-[0-9]*[1-9][0-9]*$/,"not-positive-integer":/^((-\\d+)|(0+))$/,"not-negative-integer":/^\d+$/,"float":/^(-?\\d+)(\\.\\d+)?$/,"positive-float":/^(([0-9]+\\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\\.[0-9]+)|([0-9]*[1-9][0-9]*))$/,"negative-float":/^(-(([0-9]+\\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/,"not-positive-float":/^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/,"not-negative-float":/^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/,even:function(t){return t%2==0},odd:function(t){return t%2!=0},"simple-name":/^[$_\d\w]\S*$/,word:/^[a-zA-Z]+(-[a-zA-Z]+)*$/,"has-zh":/[\u4E00-\u9FA5\uF900-\uFA2D]/,hasFullWidthChars:/[\uFF00-\uFFEF]/,date:/^\d{4}-\d{2}-\d{2}$/},_V.defaults={msg:{"text-empty":"不能为空","select-empty":"至少选择一项","checkbox-empty":"至少选择一项","radio-empty":"请选择",range:"不在规定范围(#{$0}, #{$1})内",equals:"不相等",contains:"不包含指定字符(串): #{$0}",defer:"pending...",ok:"ok"}},_V.msg={},_V.msg.ok=function(t,e){if(t&&"undefined"!=typeof e){var n=t.parentNode.querySelector(".msg");if(!n)return;n.classList.remove("fail"),n.classList.add("ok"),n.innerText=e}},_V.msg.fail=function(t,e){if(t&&"undefined"!=typeof e){var n=t.parentNode.querySelector(".msg");if(!n)return;n.classList.remove("ok"),n.classList.add("fail"),n.innerText=e}},_V.prototype.match=function(t,e){var n=this,i=arguments.callee;return isArray(t)?t.forEach(function(t){i.call(n,t,e)}):this.sequence.push({fn:function(){if(isFunction(t))return t.call(this,this.dom[0].value);if(isPattern(t))return t.lastIndex=0,t.test(this.dom[0].value);if(isString(t)){var e=_V.patterns[t];return isFunction(e)?e.call(this,this.dom[0].value):(e.lastIndex=0,e?e.test(this.dom[0].value):!1)}},args:arguments,fields:arguing({input:function(){return this.dom[0].value}},arguments),msg:e,scope:this}),this},_V.prototype.notEmpty=function(t){var e=this,n=this.dom[0];return isInputText(n)?this.match("!empty",t||_V.defaults.msg["text-empty"]):isSelect(n)?this.range(1,Number.MAX_VALUE,t||_V.defaults.msg["select-empty"]):isCheckbox(n)?this.range(1,Number.MAX_VALUE,t||_V.defaults.msg["checkbox-empty"]):isRadio(n)?this.match(function(){return 0!=[].filter.call(e.dom,function(t){return t.checked}).length},t||_V.defaults.msg["radio-empty"]):this},_V.prototype.contains=function(t,e,n){if(!isInputText(this.dom[0]))throw new Error(tmpl("#{el}不支持contains方法",{el:this.el}));return this.sequence.push({fn:function(){var n=!1;return arguments.length>1&&(n=isBoolean(e)?e:n),n?this.dom[0].value===t:-1!=this.dom[0].value.indexOf(t)},args:arguments,fields:arguing({input:function(){return this.dom[0].value}},arguments),msg:n||_V.defaults.msg.contains,scope:this}),this},_V.prototype.equals=function(t,e){return this.contains(t,!0,e||_V.defaults.msg.equals)},_V.prototype.range=function(t,e,n){var i=this;if(isCheckbox(this.dom[0]))this.sequence.push({fn:function(){var n=[].filter.call(i.dom,function(t){return t.checked}).length;return n>=t&&e>=n},args:arguments,fields:arguing({select:function(){return[].filter.call(i.dom,function(t){return t.checked}).length},input:function(){var t=[];return[].forEach.call(i.dom,function(e){e.checked&&t.push(e.value)}),t.join(",")}},arguments),msg:n||_V.defaults.msg.range,scope:this});else if(isSelect(this.dom[0]))this.sequence.push({fn:function(){var n=[].filter.call(i.dom[0].querySelectorAll("option"),function(t){return t.selected}).length;return n>=t&&e>=n},args:arguments,fields:arguing({select:function(){return[].filter.call(i.dom[0].querySelectorAll("option"),function(t){return t.selected}).length},input:function(){var t=[];return[].forEach.call(i.dom[0].querySelectorAll("option"),function(e){e.selected&&t.push(e.value)}),t.join(",")}},arguments),msg:n||_V.defaults.msg.range,scope:this});else{if(!isInputText(this.dom[0]))throw new Error(tmpl("#{el}不支持range方法",{el:this.el}));this.sequence.push({fn:function(){if(isDate(t)&&isDate(e)){var n=new Date(this.dom[0].value.replace("-","/"));return n.getTime()>=t.getTime()&&n.getTime()<=e.getTime()}if(_V.patterns.date.test(t)&&_V.patterns.date.test(e))return this.dom[0].value>=t&&this.dom[0].value<=e;if(isNumber(t)&&isNumber(e)){var n=parseFloat(this.dom[0].value);return n>=t&&e>=n}return!1},args:arguments,fields:arguing({input:function(){return i.dom[0].value}},arguments),msg:n||_V.defaults.msg.range,scope:this})}return this},_V.prototype.defer=function(t,e){if(!isFunction(t))throw new Error("defer仅支持函数参数");return this.sequence.push({fn:function(){var e=this;return new Promise(function(n,i){t.call(e,e.dom[0].value,n,i)})},args:arguments,fields:arguing({input:function(){this.dom[0].value}},arguments),msg:e||_V.defaults.msg.defer,scope:this}),this},_V.prototype.go=function(t){var e,n,i=this,r=this.sequence[Symbol.iterator](),o=!0;return function(){if(n=arguments.callee,1==o&&(e=r.next())&&!e.done){var s=Array.prototype.slice.call(e.value.args);if(o=e.value.fn.apply(e.value.scope,s),_V.msg.ok(i.dom[0],_V.defaults.msg.defer),o instanceof Promise)o.then(function(){o=!0,_V.msg.ok(i.dom[0],_V.defaults.msg.ok),n.call(i)},function(){if(e.value.args.length>0){var n=tmpl(e.value.msg,e.value.fields,i);_V.msg.fail(i.dom[0],n),i.status={passed:!1,msg:n}}o=!1,isFunction(t)&&t.call(i,i.status)});else if(o instanceof _V?o=o.go():isBoolean(o)?o:!1,o)_V.msg.ok(i.dom[0],_V.defaults.msg.ok),n.call(i);else{if(e.value.args.length>0){var a=tmpl(e.value.msg,e.value.fields,i);_V.msg.fail(i.dom[0],a),i.status={passed:!1,msg:a}}isFunction(t)&&t.call(i,i.status)}}else if(e.done)if(i.status={passed:!0,msg:_V.defaults.msg.ok},"undefined"==typeof t)_V.msg.ok(i.dom[0],i.status.msg);else if(isString(t)){var a=tmpl(t,{input:i.dom[0].value});_V.msg.ok(i.dom[0],a)}else isFunction(t)&&t.call(i,i.status)}(),e.done},V.pattern=function(t,e){2==arguments.length&&isString(t)&&(isPattern(e)||isFunction(e))&&(_V.patterns[t]=e)},V.serial=function(){var t=[];if(0!=arguments.length)return t=isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),{go:function(e){var n,i,r=t[Symbol.iterator]();!function(){if(i=arguments.callee,(n=r.next())&&!n.done){var t=new Promise(function(t,e){n.value.go(function(n){n.passed?t(n):e(n)})});t.then(function(t){i.call()},function(t){isFunction(e)&&e.call(null,n.done,n.value.status)})}else n.done&&isFunction(e)&&e.call(null,n.done,{passed:n.done,msg:_V.defaults.msg.ok})}()}}},V.parallel=function(){var t=[];if(0!=arguments.length)return t=isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),{go:function(e){var n=[];t.forEach(function(t){n.push(function(t){return new Promise(function(e,n){t.go(function(t){e(t)})})}(t))}),Promise.all(n).then(function(t){var n=t.filter(function(t){return!t.passed});0==n.length?isFunction(e)&&e.call(null,!0,[]):isFunction(e)&&e.call(null,!1,n)})}}};var root="undefined"!=typeof exports&&null!==exports?exports:window;root.V=V}();