!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Palid",[],e):"object"==typeof exports?exports.Palid=e():t.Palid=e()}(window,function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(module,exports){var $=function(t,e){return new $.fn.init(t,e)};function isDate(t){return void 0!==t&&"[object Date]"==Object.prototype.toString.call(t)}function isArray(t){return void 0!==t&&"[object Array]"==Object.prototype.toString.call(t)}function isString(t){return void 0!==t&&"[object String]"==Object.prototype.toString.call(t)}function isNumber(t){return void 0!==t&&"[object Number]"==Object.prototype.toString.call(t)}function isPattern(t){return void 0!==t&&"[object RegExp]"==Object.prototype.toString.call(t)}function isBoolean(t){return void 0!==t&&"[object Boolean]"==Object.prototype.toString.call(t)}function isFunction(t){return void 0!==t&&"[object Function]"==Object.prototype.toString.call(t)}function isInputText(t){return void 0!==t&&t.tagName&&"input"==t.tagName.toLowerCase()&&!isCheckbox(t)&&!isSelect(t)&&!isRadio(t)}function isCheckbox(t){return void 0!==t&&t.tagName&&"input"==t.tagName.toLowerCase()&&"checkbox"==t.getAttribute("type")}function isRadio(t){return void 0!==t&&t.tagName&&"input"==t.tagName.toLowerCase()&&"radio"==t.getAttribute("type")}function isSelect(t){return void 0!==t&&t.tagName&&"select"==t.tagName.toLowerCase()}function tmpl(str,data,scope){var that=scope||this;if(str)return str=str.replace(/#{([^}]*)}/g,function(val,replacement){if("input"==replacement||"select"==replacement){var fn=eval("data."+replacement);if(isFunction(fn))return fn.call(that)}return eval("data."+replacement)}),str}function arguing(t,e){return Array.prototype.slice.call(e).forEach(function(e,n){t["$"+n++]=e}),t}function _V(t){if(this.el=t,this.dom=$(t),0===this.dom.length)throw new Error(tmpl("不存在选择器#{el}",{el:this.el}));return this.sequence=[],this.status={passed:!1,msg:"",dom:this.dom},this}function V(t){return new _V(t)}$.fn=$.prototype,$.fn.init=function(t,e){var n;n=isString(t)?(e||document).querySelectorAll(t):[t],this.length=n.length;for(var o=0;o<this.length;o++)this[o]=n[o];return this},$.fn.each=function(t){for(var e=0,n=this.length;e<n;e++)t.call(this[e],e,this[e]);return this},_V.patterns={"!empty":/\S/,integer:/^-?\d+$/,float:/^(-?\\d+)(\\.\\d+)?$/,even:function(t){return t%2==0},odd:function(t){return t%2!=0},"simple-name":/^[$_\d\w]\S*$/,word:/^[a-zA-Z]+(-[a-zA-Z]+)*$/,date:/^\d{4}-\d{2}-\d{2}$/},_V.defaults={msg:{"text-empty":"不能为空","select-empty":"至少选择一项","checkbox-empty":"至少选择一项","radio-empty":"请选择",range:"不在规定范围(#{$0}, #{$1})内",equals:"不相等",contains:"不包含指定字符(串): #{$0}",defer:"pending...",ok:"ok"}},_V.msg={},_V.msg.ok=function(t,e){if(t&&void 0!==e){var n=t.parentNode.querySelector(".msg");if(!n)return;n.classList.remove("fail"),n.classList.add("ok"),n.innerText=e}},_V.msg.fail=function(t,e){if(t&&void 0!==e){var n=t.parentNode.querySelector(".msg");if(!n)return;n.classList.remove("ok"),n.classList.add("fail"),n.innerText=e}},_V.prototype.each=function(t){Array.prototype.forEach.call(this.dom,function(e){t(_V.prototype.constructor(e))})},_V.prototype.match=function(t,e){var n=this,o=arguments.callee;return isArray(t)?t.forEach(function(t){o.call(n,t,e)}):this.sequence.push({fn:function(){try{if(isFunction(t))return t.call(this,this.dom[0].value);if(isPattern(t))return t.lastIndex=0,t.test(this.dom[0].value);if(isString(t)){var e=_V.patterns[t];return isFunction(e)?e.call(this,this.dom[0].value):(e.lastIndex=0,!!e&&e.test(this.dom[0].value))}}catch(e){throw new Error(tmpl("验证规则#{p}不存在",{p:t}))}},args:arguments,fields:arguing({input:function(){return this.dom[0].value}},arguments),msg:e,scope:this}),this},_V.prototype.notEmpty=function(t){var e=this,n=this.dom[0];return isInputText(n)?this.match("!empty",t||_V.defaults.msg["text-empty"]):isSelect(n)?this.range(1,Number.MAX_VALUE,t||_V.defaults.msg["select-empty"]):isCheckbox(n)?this.range(1,Number.MAX_VALUE,t||_V.defaults.msg["checkbox-empty"]):isRadio(n)?this.match(function(){return 0!=[].filter.call(e.dom,function(t){return t.checked}).length},t||_V.defaults.msg["radio-empty"]):this},_V.prototype.contains=function(t,e,n){if(!isInputText(this.dom[0]))throw new Error(tmpl("#{el}不支持contains方法",{el:this.el}));return this.sequence.push({fn:function(){var n=!1;return arguments.length>1&&(n=isBoolean(e)?e:n),n?this.dom[0].value===t:-1!=this.dom[0].value.indexOf(t)},args:arguments,fields:arguing({input:function(){return this.dom[0].value}},arguments),msg:n||_V.defaults.msg.contains,scope:this}),this},_V.prototype.equals=function(t,e){return this.contains(t,!0,e||_V.defaults.msg.equals)},_V.prototype.range=function(t,e,n){var o=this;if(isCheckbox(this.dom[0]))this.sequence.push({fn:function(){var n=[].filter.call(o.dom,function(t){return t.checked}).length;return n>=t&&n<=e},args:arguments,fields:arguing({select:function(){return[].filter.call(o.dom,function(t){return t.checked}).length},input:function(){var t=[];return[].forEach.call(o.dom,function(e){e.checked&&t.push(e.value)}),t.join(",")}},arguments),msg:n||_V.defaults.msg.range,scope:this});else if(isSelect(this.dom[0]))this.sequence.push({fn:function(){var n=[].filter.call(o.dom[0].querySelectorAll("option"),function(t){return t.selected}).length;return n>=t&&n<=e},args:arguments,fields:arguing({select:function(){return[].filter.call(o.dom[0].querySelectorAll("option"),function(t){return t.selected}).length},input:function(){var t=[];return[].forEach.call(o.dom[0].querySelectorAll("option"),function(e){e.selected&&t.push(e.value)}),t.join(",")}},arguments),msg:n||_V.defaults.msg.range,scope:this});else{if(!isInputText(this.dom[0]))throw new Error(tmpl("#{el}不支持range方法",{el:this.el}));this.sequence.push({fn:function(){var n;return isDate(t)&&isDate(e)?(n=new Date(this.dom[0].value.replace("-","/"))).getTime()>=t.getTime()&&n.getTime()<=e.getTime():_V.patterns.date.test(t)&&_V.patterns.date.test(e)?this.dom[0].value>=t&&this.dom[0].value<=e:!(!isNumber(t)||!isNumber(e))&&((n=parseFloat(this.dom[0].value))>=t&&n<=e)},args:arguments,fields:arguing({input:function(){return o.dom[0].value}},arguments),msg:n||_V.defaults.msg.range,scope:this})}return this},_V.prototype.defer=function(t,e){if(!isFunction(t))throw new Error("defer仅支持函数参数");return this.sequence.push({fn:function(){var e=this;return new Promise(function(n,o){t.call(e,e.dom[0].value,n,o)})},args:arguments,fields:arguing({input:function(){this.dom[0].value}},arguments),msg:e||_V.defaults.msg.defer,scope:this}),this},_V.prototype.done=function(t){var e,n,o=this,r=this.sequence[Symbol.iterator](),i=!0;return function(){if(n=arguments.callee,1==i&&(e=r.next())&&!e.done){var s=Array.prototype.slice.call(e.value.args);if(i=e.value.fn.apply(e.value.scope,s),_V.msg.ok(o.dom[0],_V.defaults.msg.defer),i instanceof Promise)i.then(function(){i=!0,_V.msg.ok(o.dom[0],_V.defaults.msg.ok),n.call(o)},function(){if(e.value.args.length>0){var n=tmpl(e.value.msg,e.value.fields,o);_V.msg.fail(o.dom[0],n),o.status={passed:!1,msg:n,dom:o.dom}}i=!1,isFunction(t)&&t.call(o,o.status)});else if(i instanceof _V?i=i.done():isBoolean(i),i)_V.msg.ok(o.dom[0],_V.defaults.msg.ok),n.call(o);else{if(e.value.args.length>0){var u=tmpl(e.value.msg,e.value.fields,o);_V.msg.fail(o.dom[0],u),o.status={passed:!1,msg:u,dom:o.dom}}isFunction(t)&&t.call(o,o.status)}}else if(e.done)if(o.status={passed:!0,msg:_V.defaults.msg.ok,dom:o.dom},void 0===t)_V.msg.ok(o.dom[0],o.status.msg);else if(isString(t)){u=tmpl(t,{input:o.dom[0].value});_V.msg.ok(o.dom[0],u)}else isFunction(t)&&t.call(o,o.status)}(),e.done},V.pattern=function(t,e){2==arguments.length&&isString(t)&&(isPattern(e)||isFunction(e))&&(_V.patterns[t]=e)},V.serial=function(){var t=[];if(0!=arguments.length)return t=isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),{done:function(e){var n,o,r=t[Symbol.iterator]();!function(){(o=arguments.callee,(n=r.next())&&!n.done)?new Promise(function(t,e){n.value.done(function(n){n.passed?t(n):e(n)})}).then(function(t){o.call()},function(t){isFunction(e)&&e.call(null,n.done,n.value.status)}):n.done&&isFunction(e)&&e.call(null,n.done,{passed:n.done,msg:_V.defaults.msg.ok})}()}}},V.parallel=function(){var t=[];if(0!=arguments.length)return t=isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),{done:function(e){var n=[];t.forEach(function(t){var e;n.push((e=t,new Promise(function(t,n){e.done(function(e){t(e)})})))}),Promise.all(n).then(function(t){var n=t.filter(function(t){return!t.passed});0==n.length?isFunction(e)&&e.call(null,!0,[]):isFunction(e)&&e.call(null,!1,n)})}}},module.exports=V}])});